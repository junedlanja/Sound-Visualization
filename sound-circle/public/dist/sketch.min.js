/**
 * Sound Squares.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.0
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";function t(t,e,s,i){return t&&void 0!==e?null===e?new o(t):s?new h(t,e,i):new r(t,e):new a}class e{}class s extends e{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,s,i,n=0){super(),this.leftPositionX=t-n,this.topPositionY=e-n,this.rightPositionX=s+n,this.bottomPositionY=i+n}contains(t,e=0){return t.x>=this.leftPositionX-e&&t.x<=this.rightPositionX+e&&t.y>=this.topPositionY-e&&t.y<=this.bottomPositionY+e}constrain(t,e=0){t.x<this.leftPositionX-e?t.x=this.leftPositionX-e:t.x>this.rightPositionX+e&&(t.x=this.rightPositionX+e),t.y<this.topPositionY-e?t.y=this.topPositionY-e:t.y>this.bottomPositionY+e&&(t.y=this.bottomPositionY+e)}}class i{constructor(t,e,i,n){this.p=t,this.canvasElement=t.createCanvas(e.scaledWidth,e.scaledHeight,n),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(i),this.region=new s(0,0,0,0),this.nonScaledShortSideLength=e.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height,this.region.rightPositionX=this._nonScaledWidth,this.region.bottomPositionY=this._nonScaledHeight}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}i.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const n={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class r{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class o{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class a{stroke(){}fill(){}}class h{constructor(t,e,s=256){this.p=t;const i=[];for(let n=0;n<s;n+=1)i.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*n/(s-1)));this.colorArray=i,this.maxIndex=s-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}class l{constructor(e,s,i,n,r){this.strokeColor=t(e,s,n,r),this.fillColor=t(e,i,n,r)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}l.UNDEFINED=new l(void 0,void 0,void 0);const c=()=>{},d=(Math.PI,new p5(t=>{t.setup=(()=>{t.noCanvas()})}));Math.PI,d.createVector(),d.createVector();class u{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let s=0;s<e;s+=1)this.array[this.length+s]=t[s];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,s){let i=0;for(;i<s;)e(t[i],i,t),i+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,s){for(;s--;)e(t[s],s,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,s){for(let i=0,n=s-1;i<n;i+=1)for(let r=i+1;r<s;r+=1)e(t[i],t[r])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,s,i,n){for(let r=0;r<i;r+=1)for(let i=0;i<n;i+=1)s(t[r],e[i])}(this.array,t.array,e,this.length,t.length)}}class p extends u{static drawFunction(t){t.draw()}draw(){this.loop(p.drawFunction)}}class g extends u{static stepFunction(t){t.step()}step(){this.loop(g.stepFunction)}}class m extends u{}m.prototype.step=g.prototype.step,m.prototype.draw=p.prototype.draw;class S extends u{constructor(t){super(t),this.recentRemovedElements=new u(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class C extends S{}C.prototype.draw=m.prototype.draw,C.prototype.step=m.prototype.step;d.createVector(),d.createVector(),d.createVector();class R{constructor(){this.count=0}resetCount(t=0){return this.count=t,this}step(){this.count+=1}mod(t){return this.count%t}}class w extends R{get isOn(){return this._isOn}constructor(t,e=c){super(),this._isOn=!0,this.completeBehavior=e,this.durationFrameCount=t}on(t){return this._isOn=!0,t&&(this.durationFrameCount=t),this}off(){return this._isOn=!1,this}step(){this._isOn&&(this.count+=1,this.count>this.durationFrameCount&&this.completeCycle())}}class y extends w{get isCompleted(){return this._isCompleted}constructor(t,e){super(t,e),this._isCompleted=!1}on(t){return super.on(t),this}off(){return super.off(),this}resetCount(){return super.resetCount(),this._isCompleted=!1,this}getProgressRatio(){return this._isCompleted?1:this.count/this.durationFrameCount}completeCycle(){this._isCompleted=!0,this._isOn=!1,this.completeBehavior()}}class v{constructor(t,e=1024){this.pooledObjects=[];for(let s=0;s<e;s+=1)this.pooledObjects.push(t());this.index=e}get length(){return this.index}get(){return this.index-=1,this.pooledObjects[this.index]}put(t){this.pooledObjects[this.index]=t,this.index+=1}}p5.disableFriendlyErrors=!0;new p5;class f{constructor(t){this.p=t,this.isToBeRemoved=!1,this.shrinkRatio=0,f.isInitialized||(f.color=new l(t,t.color(0,128),void 0,!0),f.isInitialized=!0),this.timer=new y(30,()=>{})}set(t,e,s,i){return this.isToBeRemoved=!1,this.parent=t,this.x=e,this.y=s,this.size=i,this.timer.resetCount().on(),this.shrinkRatio=this.p.random(-.1,.3),this}step(){this.timer.step()}clean(){this.timer.isCompleted&&(this.isToBeRemoved=!0,this.parent.pool.put(this))}draw(){const t=1-this.timer.getProgressRatio();if(t<.001)return;f.color.applyColor(255*t);const e=this.size*(1-this.shrinkRatio+this.shrinkRatio*t);this.p.rect(this.x,this.y,e,e)}}f.isInitialized=!1;new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,s){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,s),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,s){this.scalableCanvasType=t,this.scalableCanvas=new i(this,this.createScalableCanvasParameter(t,e),this.node,s)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const s=this.maxCanvasRegion.getShortSideLength();switch(t){case n.SQUARE640x640:return{scaledWidth:s,scaledHeight:s,nonScaledShortSideLength:640};case n.RECT640x480:return{scaledWidth:s,scaledHeight:.75*s,nonScaledShortSideLength:480};case n.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||i.DUMMY_PARAMETERS}}}(t=>{function e(){const e=function(t,e,s,i,n,r){const o=t.createGraphics(e,s);o.background(i),o.strokeWeight(2);for(let a=0;a<s;a+=1){const i=a/(s-1);o.stroke(t.lerpColor(n,r,i)),o.line(0,a,e-1,a)}return o}(t,t.width,t.height,t.color(255,255,255),t.color(255,255,255),t.color(244,244,248));return t.image(e,0,0),t.loadPixels(),t.pixels}const s=t.color(96);let i,r,o,a=-1;t.preload=(()=>{i=new p5.SoundFile("./assets/bgml060.mp3",()=>{i.setVolume(1),i.loop(),r.isActive=!0})}),t.setup=(()=>{window.noCanvas(),t.createScalableCanvas(n.SQUARE640x640),t.setFrameRate(30),t.rectMode(t.CENTER),t.textFont("Georgia",20),o=e(),r=new class{constructor(t){this.p=t,this.isToBeRemoved=!1,this.isActive=!1,this.squares=new C(128),this.rotationAngle=Math.PI/4,this.analyzer=new p5.Amplitude,this.pool=new v(()=>new f(t),128)}step(){if(!this.isActive)return;this.squares.step();const t=.85*this.p.nonScaledWidth,e=Math.min(this.p.random(.5,1)*t*this.analyzer.getLevel(),.4*this.p.nonScaledWidth);this.generate(e),this.generate(e),this.rotationAngle+=.002}generate(t){const e=2*t;let s,i;switch(function(t){return Math.floor(Math.random()*t)}(4)){default:case 0:s=1,i=1;break;case 1:s=-1,i=1;break;case 2:s=-1,i=-1;break;case 3:s=1,i=-1}const n=.2*e;s*=t-Math.random()*n,i*=t-Math.random()*n,this.squares.push(this.pool.get().set(this,s,i,e))}clean(){this.squares.clean()}draw(){this.isActive&&(this.p.noFill(),this.p.translate(.5*this.p.nonScaledWidth,.5*this.p.nonScaledHeight),this.p.rotate(this.rotationAngle),this.squares.draw())}}(t)}),t.draw=(()=>{t.pixels=o,t.updatePixels(),t.scalableCanvas.scale(),function(){if(r.isActive&&i.isPlaying())return;t.noStroke(),t.fill(s);const e=r.isActive?"Click to play...":"Please wait a few seconds for loading music...";t.text(e,100,60)}(),r.step(),r.clean(),r.draw()}),t.windowResized=(()=>{t.resizeScalableCanvas(),-1!==a&&clearTimeout(a),a=setTimeout(()=>{o=e()},200)}),t.mouseClicked=(()=>{i.isPlaying()?i.pause():i.play()})},"SoundSquares")}();